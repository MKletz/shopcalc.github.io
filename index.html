<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopBench Pro // Precision Dashboard</title>
    <style>
        :root { --wood: #e67e22; --slate: #2c3e50; --bg: #121212; --decimal-blue: #3498db; --success: #27ae60; --purple: #9b59b6; }
        body { font-family: 'Segoe UI', sans-serif; background: #333; color: white; margin: 0; padding: 20px; }
        
        .dashboard { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: flex-start; }
        .widget { background: #1a1a1a; border-radius: 12px; padding: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #444; width: 100%; max-width: 500px; margin-bottom: 20px; }
        h2 { margin-top: 0; color: var(--wood); font-size: 1.1rem; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }

        .display { background: #000; padding: 1.2rem; border-radius: 6px; text-align: right; margin-bottom: 10px; border-bottom: 4px solid var(--wood); position: relative; }
        .res-total { font-size: 2.2rem; color: var(--wood); font-weight: bold; }
        .res-input { font-size: 0.9rem; color: #7f8c8d; min-height: 1.2rem; }
        
        .global-settings { background: #222; padding: 12px; border-radius: 6px; margin-bottom: 15px; }
        .snap-control { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #333; cursor: pointer; }
        .snap-control input { width: 18px; height: 18px; cursor: pointer; accent-color: var(--success); }
        .snap-label { font-size: 0.85rem; font-weight: bold; color: #eee; }

        .precision-picker { display: flex; gap: 5px; margin-top: 8px; }
        .precision-picker.disabled { opacity: 0.3; pointer-events: none; }
        .precision-picker button { font-size: 0.75rem; padding: 8px; background: #444; color: #ccc; flex: 1; border: none; cursor: pointer; border-radius: 4px; }
        .precision-picker button.active { background: var(--success); color: white; }

        .layout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        button { border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.1s; }
        button:active { transform: scale(0.95); }
        
        .btn-num { background: #3d3d3d; color: white; padding: 15px 0; font-size: 1.1rem; }
        .btn-den { background: #2980b9; color: white; padding: 15px 0; font-size: 1.1rem; }
        .btn-op { background: var(--wood); color: white; padding: 12px 0; font-size: 1.3rem; }
        .btn-clr { background: #c0392b; color: white; }
        .btn-toggle { background: var(--decimal-blue); color: white; padding: 10px; font-size: 0.8rem; text-transform: uppercase; width: 100%; border-radius: 4px; }
        
        .action-area { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .btn-eq { background: var(--success); color: white; padding: 15px; font-size: 1.4rem; width: 100%; }
        .btn-save { background: var(--purple); color: white; padding: 12px; font-size: 1.1rem; text-transform: uppercase; width: 100%; }

        .l-field { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .l-field input { background: #000; border: 1px solid #444; color: var(--wood); padding: 8px; border-radius: 4px; width: 90px; text-align: center; font-size: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.85rem; }
        th { text-align: left; color: #888; border-bottom: 1px solid #333; padding: 8px; font-size: 0.7rem; text-transform: uppercase; }
        td { padding: 10px 8px; border-bottom: 1px solid #222; }
        .highlight { color: var(--wood); font-weight: bold; }

        /* History Collapsible Styling */
        .history-container { margin-top: 15px; }
        .history-toggle { width: 100%; background: #444; color: #bbb; padding: 8px; font-size: 0.75rem; text-transform: uppercase; border-radius: 4px; cursor: pointer; text-align: center; }
        .history { display: none; margin-top: 5px; background: #222; padding: 8px; border-radius: 4px; max-height: 120px; overflow-y: auto; font-family: monospace; font-size: 0.8rem; color: #777; border: 1px solid #333; }
        .btn-del-save { background: #c0392b; color: white; padding: 4px 8px; font-size: 0.7rem; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="widget">
        <h2>Precision Calculator</h2>
        
        <div class="global-settings">
            <button class="btn-toggle" onclick="toggleDisplayMode()" style="margin-bottom: 12px;">ðŸ”„ Mode: <span id="mode-text">Fractional</span></button>
            <label class="snap-control">
                <input type="checkbox" id="snap-toggle" onchange="toggleSnap()">
                <span class="snap-label">Snap to Nearest Fraction</span>
            </label>
            <div id="prec-container" class="precision-picker disabled">
                <button class="prec-btn" onclick="setPrecision(4)">1/4</button>
                <button class="prec-btn" onclick="setPrecision(8)">1/8</button>
                <button class="prec-btn active" onclick="setPrecision(16)">1/16</button>
                <button class="prec-btn" onclick="setPrecision(32)">1/32</button>
                <button class="prec-btn" onclick="setPrecision(64)">1/64</button>
            </div>
        </div>

        <div class="display">
            <div id="preview" class="res-input">0"</div>
            <div id="total" class="res-total">0"</div>
        </div>

        <div class="layout-grid">
            <div>
                <div class="pad">
                    <button class="btn-num" onclick="press('w', 7)">7</button>
                    <button class="btn-num" onclick="press('w', 8)">8</button>
                    <button class="btn-num" onclick="press('w', 9)">9</button>
                    <button class="btn-num" onclick="press('w', 4)">4</button>
                    <button class="btn-num" onclick="press('w', 5)">5</button>
                    <button class="btn-num" onclick="press('w', 6)">6</button>
                    <button class="btn-num" onclick="press('w', 1)">1</button>
                    <button class="btn-num" onclick="press('w', 2)">2</button>
                    <button class="btn-num" onclick="press('w', 3)">3</button>
                    <button class="btn-num" onclick="press('w', '.')">.</button>
                    <button class="btn-num" onclick="press('w', 0)">0</button>
                    <button class="btn-clr" onclick="clearInput()">CE</button>
                </div>
                <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:6px; margin-top:8px;">
                    <button class="btn-op" onclick="handleOp('add')">+</button>
                    <button class="btn-op" onclick="handleOp('sub')">-</button>
                    <button class="btn-op" onclick="handleOp('mul')">Ã—</button>
                    <button class="btn-op" onclick="handleOp('div')">Ã·</button>
                </div>
            </div>

            <div>
                <div class="pad">
                    <button class="btn-num" onclick="press('n', 7)">7</button>
                    <button class="btn-num" onclick="press('n', 8)">8</button>
                    <button class="btn-num" onclick="press('n', 9)">9</button>
                    <button class="btn-num" onclick="press('n', 4)">4</button>
                    <button class="btn-num" onclick="press('n', 5)">5</button>
                    <button class="btn-num" onclick="press('n', 6)">6</button>
                    <button class="btn-num" onclick="press('n', 1)">1</button>
                    <button class="btn-num" onclick="press('n', 2)">2</button>
                    <button class="btn-num" onclick="press('n', 3)">3</button>
                    <button class="btn-clr" style="grid-column: span 2" onclick="reset()">RESET</button>
                    <button class="btn-num" onclick="press('n', 0)">0</button>
                </div>
                <div class="pad" style="margin-top:10px;">
                    <button class="btn-den" onclick="setDen(4)">/4</button>
                    <button class="btn-den" onclick="setDen(8)">/8</button>
                    <button class="btn-den" onclick="setDen(16)">/16</button>
                    <button class="btn-den" onclick="setDen(32)">/32</button>
                    <button class="btn-den" style="grid-column: span 2" onclick="setDen(64)">/64</button>
                </div>
            </div>
        </div>
        
        <div class="action-area">
            <button class="btn-eq" onclick="finish()">TOTAL (=)</button>
            <button class="btn-save" onclick="saveMeasurement()">ðŸ’¾ Save to Cut List</button>
        </div>
        
        <div class="history-container">
            <div class="history-toggle" onclick="toggleHistory()">ðŸ“‹ View Calculation History</div>
            <div class="history" id="history-log">History: Ready</div>
        </div>
    </div>

    <div style="width: 100%; max-width: 500px;">
        <div class="widget">
            <h2>Saved Measurements (Cut List)</h2>
            <table id="saved-list-table">
                <thead>
                    <tr>
                        <th>Part Name</th>
                        <th>Measurement</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="saved-list-body"></tbody>
            </table>
        </div>

        <div class="widget">
            <h2>Equal Spacing Layout</h2>
            <div class="l-field">
                <label>Total Length (in)</label>
                <input type="number" id="lay-length" value="24" step="0.0625" oninput="calculateLayout()">
            </div>
            <div class="l-field">
                <label>Number of Holes</label>
                <input type="number" id="lay-count" value="3" oninput="calculateLayout()">
            </div>
            <div class="l-field">
                <label>Hole Diameter (in)</label>
                <input type="number" id="lay-diam" value="0.25" step="0.0625" oninput="calculateLayout()">
            </div>
            <div id="layout-summary" style="background:#000; padding:10px; border-radius:4px; font-size:0.85rem; color:#888; margin:15px 0;">
                Spacing...
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Mark #</th>
                        <th>From Edge (Center)</th>
                        <th>C-to-C Gap</th>
                    </tr>
                </thead>
                <tbody id="layout-table-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    let totalValue = 0;
    let inputW = "0"; let inputN = "0"; let inputD = 1;
    let nextOp = 'add'; 
    let displayMode = 'fraction'; 
    let roundingDenominator = 16;
    let isSnapEnabled = false; 
    let isFirstEntry = true;
    let savedMeasurements = [];

    const ops = { 
        add: { sym: '+', fn: (a, b) => a + b }, 
        sub: { sym: '-', fn: (a, b) => a - b }, 
        mul: { sym: 'Ã—', fn: (a, b) => a * b }, 
        div: { sym: 'Ã·', fn: (a, b) => b === 0 ? a : a / b } 
    };

    function toggleHistory() {
        const log = document.getElementById('history-log');
        const toggle = document.querySelector('.history-toggle');
        if (log.style.display === 'block') {
            log.style.display = 'none';
            toggle.innerText = 'ðŸ“‹ View Calculation History';
        } else {
            log.style.display = 'block';
            toggle.innerText = 'âŒ Close History';
        }
    }

    function toggleSnap() {
        isSnapEnabled = document.getElementById('snap-toggle').checked;
        const container = document.getElementById('prec-container');
        if (isSnapEnabled) container.classList.remove('disabled');
        else container.classList.add('disabled');
        updateDisplay(); updatePreview(); calculateLayout(); updateSavedList();
    }

    function setPrecision(d) {
        roundingDenominator = d;
        document.querySelectorAll('.prec-btn').forEach(btn => {
            btn.classList.toggle('active', parseInt(btn.innerText.split('/')[1]) === d);
        });
        updateDisplay(); updatePreview(); calculateLayout(); updateSavedList();
    }

    function formatResult(val) {
        if (displayMode === 'decimal') return val.toFixed(4) + '"';
        const sign = val < 0 ? "-" : "";
        const absVal = Math.abs(val);
        const w = Math.floor(absVal);
        const rem = absVal - w;
        let numerator, denominator;
        if (isSnapEnabled) {
            const units = Math.round(rem * roundingDenominator);
            if (units === 0) return `${sign}${w}"`;
            if (units === roundingDenominator) return `${sign}${w + 1}"`;
            numerator = units; denominator = roundingDenominator;
        } else {
            const sixtyFourths = Math.round(rem * 64);
            if (sixtyFourths === 0) return `${sign}${w}"`;
            if (sixtyFourths === 64) return `${sign}${w + 1}"`;
            numerator = sixtyFourths; denominator = 64;
        }
        const common = gcd(numerator, denominator);
        return `${sign}${w > 0 ? w + ' ' : ''}${numerator/common}/${denominator/common}"`;
    }

    function gcd(a, b) { return b ? gcd(b, a % b) : a; }

    function press(type, val) {
        if (type === 'w') {
            if (val === '.' && inputW.includes('.')) return;
            inputW = inputW === "0" && val !== '.' ? val.toString() : inputW + val;
        } else {
            inputN = inputN === "0" ? val.toString() : inputN + val;
        }
        updatePreview();
    }
    function setDen(d) { inputD = d; updatePreview(); }
    function getCurrentIn() { return (parseFloat(inputW)||0) + ((parseInt(inputN)||0)/inputD); }
    
    function handleOp(opKey) {
        const cur = getCurrentIn();
        if (isFirstEntry) {
            totalValue = cur;
            logHistory(`Start: ${formatResult(cur)}`);
            isFirstEntry = false;
        } else {
            logHistory(`${ops[nextOp].sym} ${formatResult(cur)}`);
            totalValue = ops[nextOp].fn(totalValue, cur);
        }
        nextOp = opKey; clearInput(); updateDisplay();
    }

    function finish() {
        const cur = getCurrentIn();
        if (isFirstEntry) {
            totalValue = cur;
            logHistory(`Start: ${formatResult(cur)}`);
            isFirstEntry = false;
        } else if (cur !== 0 || inputW !== "0") {
            logHistory(`${ops[nextOp].sym} ${formatResult(cur)}`);
            totalValue = ops[nextOp].fn(totalValue, cur);
        }
        updateDisplay();
        logHistory(`<strong>= ${formatResult(totalValue)}</strong>`);
        clearInput();
        nextOp = 'add';
    }

    function saveMeasurement() {
        if (totalValue === 0 && isFirstEntry) return;
        const partName = prompt("Enter a name for this measurement:", "Part " + (savedMeasurements.length + 1));
        if (partName) {
            savedMeasurements.push({ name: partName, value: totalValue });
            updateSavedList();
        }
    }

    function updateSavedList() {
        const tbody = document.getElementById('saved-list-body');
        tbody.innerHTML = '';
        savedMeasurements.forEach((item, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.name}</td>
                <td class="highlight">${formatResult(item.value)}</td>
                <td><button class="btn-del-save" onclick="deleteSave(${index})">Delete</button></td>
            `;
            tbody.appendChild(row);
        });
    }

    function deleteSave(index) {
        savedMeasurements.splice(index, 1);
        updateSavedList();
    }

    function toggleDisplayMode() {
        displayMode = displayMode === 'fraction' ? 'decimal' : 'fraction';
        document.getElementById('mode-text').innerText = displayMode.charAt(0).toUpperCase() + displayMode.slice(1);
        updateDisplay(); updatePreview(); calculateLayout(); updateSavedList();
    }

    function updatePreview() { document.getElementById('preview').innerText = `${ops[nextOp].sym} ${formatResult(getCurrentIn())}`; }
    function updateDisplay() { document.getElementById('total').innerText = formatResult(totalValue); }
    function clearInput() { inputW = "0"; inputN = "0"; inputD = 1; updatePreview(); }
    function reset() { totalValue = 0; nextOp = 'add'; isFirstEntry = true; clearInput(); updateDisplay(); document.getElementById('history-log').innerHTML = "History: Ready"; }
    function logHistory(msg) { const log = document.getElementById('history-log'); log.innerHTML += `<div>${msg}</div>`; log.scrollTop = log.scrollHeight; }

    function calculateLayout() {
        const L = parseFloat(document.getElementById('lay-length').value) || 0;
        const n = parseInt(document.getElementById('lay-count').value) || 0;
        const tbody = document.getElementById('layout-table-body');
        const summary = document.getElementById('layout-summary');
        tbody.innerHTML = '';
        if (L <= 0 || n <= 0) return;
        const centerSpacing = L / (n + 1);
        summary.innerHTML = `C-to-C Gap: <span class="highlight">${formatResult(centerSpacing)}</span>`;
        for (let i = 1; i <= n; i++) {
            const row = document.createElement('tr');
            row.innerHTML = `<td>Mark ${i}</td><td class="highlight">${formatResult(centerSpacing * i)}</td><td>${i === 1 ? 'Start' : formatResult(centerSpacing)}</td>`;
            tbody.appendChild(row);
        }
    }
    calculateLayout();
</script>
</body>
</html>