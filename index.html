<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Calc - Auto-Save Enabled</title>
    <style>
        :root { --wood: #e67e22; --slate: #2c3e50; --bg: #121212; --decimal-blue: #3498db; --success: #27ae60; --purple: #9b59b6; --danger: #c0392b; }
        body { font-family: 'Segoe UI', sans-serif; background: #333; color: white; margin: 0; padding: 20px; }
        
        /* Toast Notification Styles */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: var(--slate);
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 1000;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-left: 5px solid var(--success);
            font-weight: bold;
        }

        #toast.show {
            visibility: visible;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        .header-area { max-width: 1040px; margin: 0 auto 10px auto; display: flex; justify-content: space-between; align-items: flex-end; flex-wrap: wrap; gap: 15px; }
        .title-container { flex-grow: 1; }
        .project-title-input { background: transparent; border: none; border-bottom: 2px solid #555; color: var(--wood); font-size: 2rem; font-weight: bold; width: 100%; max-width: 600px; outline: none; transition: 0.3s; }
        .project-title-input:focus { border-bottom-color: var(--wood); }
        .project-label { font-size: 0.7rem; text-transform: uppercase; color: #888; letter-spacing: 1px; display: block; margin-bottom: 5px; }

        .btn-group { display: flex; gap: 10px; }
        .btn-share { background: var(--success); color: white; padding: 12px 20px; font-size: 0.9rem; border-radius: 6px; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-reset-proj { background: var(--danger); color: white; padding: 12px 20px; font-size: 0.9rem; border-radius: 6px; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; font-weight: bold; }

        .notes-hero { max-width: 1040px; margin: 0 auto 20px auto; }
        .dashboard { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; align-items: flex-start; }
        .widget { background: #1a1a1a; border-radius: 12px; padding: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #444; width: 100%; max-width: 500px; margin-bottom: 20px; position: relative; box-sizing: border-box; }
        .widget-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        h2 { margin: 0; color: var(--wood); font-size: 1.1rem; text-transform: uppercase; }

        .display { background: #000; padding: 1.2rem; border-radius: 6px; text-align: right; margin-bottom: 10px; border-bottom: 4px solid var(--wood); }
        .res-total { font-size: 2.2rem; color: var(--wood); font-weight: bold; }
        .res-input { font-size: 0.9rem; color: #7f8c8d; min-height: 1.2rem; }
        
        .global-settings { background: #222; padding: 12px; border-radius: 6px; margin-bottom: 15px; }
        .snap-control { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid #333; cursor: pointer; }
        .snap-control input { width: 18px; height: 18px; cursor: pointer; accent-color: var(--success); }
        .snap-label { font-size: 0.85rem; font-weight: bold; color: #eee; }

        .precision-picker { display: flex; gap: 5px; margin-top: 8px; }
        .precision-picker.disabled { opacity: 0.3; pointer-events: none; }
        .precision-picker button { font-size: 0.75rem; padding: 8px; background: #444; color: #ccc; flex: 1; border: none; cursor: pointer; border-radius: 4px; }
        .precision-picker button.active { background: var(--success); color: white; }

        .layout-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px; }
        .pad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        button { border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.1s; }
        
        .btn-num { background: #3d3d3d; color: white; padding: 15px 0; font-size: 1.1rem; }
        .btn-den { background: #2980b9; color: white; padding: 15px 0; font-size: 1.1rem; }
        .btn-op { background: var(--wood); color: white; padding: 12px 0; font-size: 1.3rem; }
        .btn-clr { background: var(--danger); color: white; }
        .btn-toggle { background: var(--decimal-blue); color: white; padding: 10px; font-size: 0.8rem; text-transform: uppercase; width: 100%; border-radius: 4px; }
        .btn-clear-list { background: transparent; border: 1px solid var(--danger); color: var(--danger); padding: 4px 8px; font-size: 0.65rem; text-transform: uppercase; border-radius: 4px; }

        .action-area { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .btn-eq { background: var(--success); color: white; padding: 15px; font-size: 1.4rem; width: 100%; }
        .btn-save { background: var(--purple); color: white; padding: 12px; font-size: 1.1rem; text-transform: uppercase; width: 100%; }

        .history-section { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; }
        .history-summary { cursor: pointer; font-size: 0.8rem; color: #888; padding: 5px 0; outline: none; }
        .history-list { max-height: 150px; overflow-y: auto; margin-top: 10px; font-family: monospace; font-size: 0.8rem; }
        .history-entry { display: flex; align-items: center; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #222; }
        
        .notes-area { width: 100%; min-height: 100px; background: #111; border: 1px solid #444; color: #ddd; padding: 12px; border-radius: 6px; resize: vertical; box-sizing: border-box; line-height: 1.5; font-family: inherit; font-size: 0.95rem;}
        .l-field { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .l-field input { background: #000; border: 1px solid #444; color: var(--wood); padding: 8px; border-radius: 4px; width: 90px; text-align: center; font-size: 1rem; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.85rem; }
        th { text-align: left; color: #888; border-bottom: 1px solid #333; padding: 8px; font-size: 0.7rem; text-transform: uppercase; }
        td { padding: 10px 8px; border-bottom: 1px solid #222; }
        .highlight { color: var(--wood); font-weight: bold; }
        .distinct { color: var(--success); font-weight: bold; }
        .btn-del-save { background: var(--danger); color: white; padding: 6px 10px; font-size: 0.75rem; border-radius: 4px; }
    </style>
</head>
<body>

<div id="toast">üîó Project Link Copied!</div>

<div class="header-area">
    <div class="title-container">
        <span class="project-label">Project Name (Auto-Saves Locally)</span>
        <input type="text" id="project-title" class="project-title-input" placeholder="Untitled Project..." oninput="syncState()">
    </div>
    <div class="btn-group">
        <button class="btn-reset-proj" onclick="resetFullProject()">üóëÔ∏è Reset Project</button>
        <button class="btn-share" onclick="copyProjectLink()">üîó Copy Link</button>
    </div>
</div>

<div class="notes-hero">
    <div class="widget" style="max-width: 1040px; margin: 0 auto;">
        <div class="widget-header"><h2>Project Notes</h2></div>
        <textarea id="project-notes" class="notes-area" placeholder="Enter measurements, hardware list, or assembly reminders here..." oninput="syncState()"></textarea>
    </div>
</div>

<div class="dashboard">
    <div class="widget">
        <div class="widget-header"><h2>Precision Calculator</h2></div>
        <div class="global-settings">
            <button class="btn-toggle" onclick="toggleDisplayMode()">üîÑ Mode: <span id="mode-text">Fractional</span></button>
            <label class="snap-control" style="margin-top:10px;">
                <input type="checkbox" id="snap-toggle" onchange="toggleSnap()">
                <span class="snap-label">Snap to Nearest Fraction</span>
            </label>
            <div id="prec-container" class="precision-picker disabled">
                <button class="prec-btn" onclick="setPrecision(4)">1/4</button>
                <button class="prec-btn" onclick="setPrecision(8)">1/8</button>
                <button class="prec-btn active" onclick="setPrecision(16)">1/16</button>
                <button class="prec-btn" onclick="setPrecision(32)">1/32</button>
                <button class="prec-btn" onclick="setPrecision(64)">1/64</button>
            </div>
        </div>
        <div class="display">
            <div id="preview" class="res-input">0"</div>
            <div id="total" class="res-total">0"</div>
        </div>
        <div class="layout-grid">
            <div>
                <div class="pad">
                    <button class="btn-num" onclick="press('w', 7)">7</button><button class="btn-num" onclick="press('w', 8)">8</button><button class="btn-num" onclick="press('w', 9)">9</button>
                    <button class="btn-num" onclick="press('w', 4)">4</button><button class="btn-num" onclick="press('w', 5)">5</button><button class="btn-num" onclick="press('w', 6)">6</button>
                    <button class="btn-num" onclick="press('w', 1)">1</button><button class="btn-num" onclick="press('w', 2)">2</button><button class="btn-num" onclick="press('w', 3)">3</button>
                    <button class="btn-num" onclick="press('w', '.')">.</button><button class="btn-num" onclick="press('w', 0)">0</button><button class="btn-clr" onclick="clearInput()">CE</button>
                </div>
            </div>
            <div>
                <div class="pad">
                    <button class="btn-num" onclick="press('n', 7)">7</button><button class="btn-num" onclick="press('n', 8)">8</button><button class="btn-num" onclick="press('n', 9)">9</button>
                    <button class="btn-num" onclick="press('n', 4)">4</button><button class="btn-num" onclick="press('n', 5)">5</button><button class="btn-num" onclick="press('n', 6)">6</button>
                    <button class="btn-num" onclick="press('n', 1)">1</button><button class="btn-num" onclick="press('n', 2)">2</button><button class="btn-num" onclick="press('n', 3)">3</button>
                    <button class="btn-clr" style="grid-column: span 2" onclick="resetCalc()">RESET</button><button class="btn-num" onclick="press('n', 0)">0</button>
                </div>
            </div>
        </div>
        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:6px; margin-top:8px;">
            <button class="btn-op" onclick="handleOp('add')">+</button><button class="btn-op" onclick="handleOp('sub')">-</button>
            <button class="btn-op" onclick="handleOp('mul')">√ó</button><button class="btn-op" onclick="handleOp('div')">√∑</button>
        </div>
        <div class="pad" style="margin-top:10px;">
            <button class="btn-den" onclick="setDen(4)">/4</button><button class="btn-den" onclick="setDen(8)">/8</button><button class="btn-den" onclick="setDen(16)">/16</button>
            <button class="btn-den" onclick="setDen(32)">/32</button><button class="btn-den" style="grid-column: span 2" onclick="setDen(64)">/64</button>
        </div>
        <div class="action-area">
            <button class="btn-eq" onclick="finish()">TOTAL (=)</button>
            <button class="btn-save" onclick="saveMeasurement()">üíæ Save to Cut List</button>
        </div>

        <div style="margin-top:25px; border-top: 1px solid #333; padding-top:15px;">
            <div class="widget-header"><h2>Saved Cut List</h2><button class="btn-clear-list" onclick="clearAllSaved()">Clear</button></div>
            <table id="saved-list-table">
                <thead><tr><th>Part Name</th><th>Measurement</th><th>Action</th></tr></thead>
                <tbody id="saved-list-body"></tbody>
            </table>
        </div>

        <details class="history-section">
            <summary class="history-summary">Calculation Tape</summary>
            <div id="history-log" class="history-list"></div>
        </details>
    </div>

    <div style="width: 100%; max-width: 500px;">
        <div class="widget">
            <div class="widget-header"><h2>Equal Spacing Layout</h2></div>
            <div class="l-field"><label>Total Length</label><input type="number" id="lay-length" value="24" oninput="calculateLayout()"></div>
            <div class="l-field"><label style="font-size: 0.8rem; color: #888;">Mirror Offsets</label><input type="checkbox" id="lay-mirror" checked onchange="toggleMirrorUI()"></div>
            <div id="mirror-input-container" class="l-field"><label>Edge Offset</label><input type="number" id="lay-offset-mirror" value="1" oninput="calculateLayout()"></div>
            <div id="split-input-container" style="display: none;">
                <div class="l-field"><label>Start Offset</label><input type="number" id="lay-offset-start" value="1" oninput="calculateLayout()"></div>
                <div class="l-field"><label>End Offset</label><input type="number" id="lay-offset-end" value="1" oninput="calculateLayout()"></div>
            </div>
            <div class="l-field"><label>Hole Count</label><input type="number" id="lay-count" value="3" oninput="calculateLayout()"></div>
            <table id="layout-table">
                <thead><tr><th>Mark #</th><th>Position</th><th>Gap</th></tr></thead>
                <tbody id="layout-table-body"></tbody>
            </table>
        </div>

        <div class="widget">
            <div class="widget-header"><h2>Board Foot Calc & Material</h2></div>
            <div class="l-field"><label>Thick (in)</label><input type="number" id="bf-thick" value="1" oninput="calculateBF()"></div>
            <div class="l-field"><label>Width (in)</label><input type="number" id="bf-width" value="6" oninput="calculateBF()"></div>
            <div class="l-field"><label>Length (ft)</label><input type="number" id="bf-length" value="8" oninput="calculateBF()"></div>
            <div class="l-field"><label>Cost/BF ($)</label><input type="number" id="bf-cost" value="5.50" oninput="calculateBF()"></div>
            <div class="l-field"><label>Qty</label><input type="number" id="bf-qty" value="1" oninput="calculateBF()"></div>
            <div style="background: #000; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid var(--success);">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>BF:</span><span id="res-bf-val" class="distinct">0.00 BF</span></div>
                <div style="display:flex; justify-content:space-between; font-size:1.2rem;"><span>Cost:</span><span id="res-bf-cost" class="highlight">$0.00</span></div>
            </div>
            <button class="btn-save" style="margin-top:10px;" onclick="saveMaterial()">üíæ Save Material</button>
            <div style="margin-top:20px; border-top: 1px solid #333; padding-top:15px;">
                <div class="widget-header"><h2>Material List</h2><button class="btn-clear-list" onclick="clearAllMaterials()">Clear</button></div>
                <table>
                    <tbody id="material-list-body"></tbody>
                    <tfoot><tr><td><strong>TOTAL:</strong></td><td id="grand-bf" class="distinct">0.00</td><td id="grand-cost" class="highlight">$0.00</td><td></td></tr></tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let totalValue = 0, inputW = "0", inputN = "0", inputD = 1, nextOp = 'add';
    let displayMode = 'fraction', roundingDenominator = 16, isSnapEnabled = false, isFirstEntry = true;
    let savedMeasurements = [], savedMaterials = [];

    const ops = { add: { sym: '+', fn: (a, b) => a + b }, sub: { sym: '-', fn: (a, b) => a - b }, mul: { sym: '√ó', fn: (a, b) => a * b }, div: { sym: '√∑', fn: (a, b) => b === 0 ? a : a / b } };

    function syncState() {
        const state = {
            t: document.getElementById('project-title').value,
            n: document.getElementById('project-notes').value,
            m: savedMeasurements, mat: savedMaterials,
            l: { len: document.getElementById('lay-length').value, cnt: document.getElementById('lay-count').value, mir: document.getElementById('lay-mirror').checked, offM: document.getElementById('lay-offset-mirror').value, offS: document.getElementById('lay-offset-start').value, offE: document.getElementById('lay-offset-end').value },
            cfg: { mode: displayMode, snap: isSnapEnabled, prec: roundingDenominator }
        };
        const encoded = btoa(JSON.stringify(state));
        window.history.replaceState(null, null, "#" + encoded);
        localStorage.setItem('shop_calc_last_project', encoded);
    }

    function resetFullProject() {
        if(confirm("Are you sure? This clears all local data and your URL link.")) {
            localStorage.removeItem('shop_calc_last_project');
            window.location.hash = "";
            location.reload();
        }
    }

    function loadProject() {
        try {
            let data = window.location.hash.substring(1) || localStorage.getItem('shop_calc_last_project');
            if (!data) return;
            const state = JSON.parse(atob(data));
            document.getElementById('project-title').value = state.t || "";
            document.getElementById('project-notes').value = state.n || "";
            savedMeasurements = state.m || [];
            savedMaterials = state.mat || [];
            if (state.l) {
                document.getElementById('lay-length').value = state.l.len; document.getElementById('lay-count').value = state.l.cnt;
                document.getElementById('lay-mirror').checked = state.l.mir; document.getElementById('lay-offset-mirror').value = state.l.offM;
                document.getElementById('lay-offset-start').value = state.l.offS; document.getElementById('lay-offset-end').value = state.l.offE;
            }
            if (state.cfg) {
                displayMode = state.cfg.mode; isSnapEnabled = state.cfg.snap; roundingDenominator = state.cfg.prec;
                document.getElementById('snap-toggle').checked = isSnapEnabled;
                document.getElementById('mode-text').innerText = displayMode === 'fraction' ? 'Fractional' : 'Decimal';
            }
            toggleMirrorUI(); refreshUI();
        } catch (e) { console.error("Load failed", e); }
    }

    function showToast() {
        const x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
    }

    function copyProjectLink() { 
        syncState(); 
        navigator.clipboard.writeText(window.location.href).then(() => {
            showToast();
        }); 
    }

    function refreshUI() { updateDisplay(); updatePreview(); calculateLayout(); updateSavedList(); calculateBF(); updateMaterialList(); }
    function toggleSnap() { isSnapEnabled = document.getElementById('snap-toggle').checked; document.getElementById('prec-container').classList.toggle('disabled', !isSnapEnabled); syncState(); refreshUI(); }
    function setPrecision(d) { roundingDenominator = d; document.querySelectorAll('.prec-btn').forEach(b => b.classList.toggle('active', b.innerText.includes(d))); syncState(); refreshUI(); }
    function toggleDisplayMode() { displayMode = displayMode === 'fraction' ? 'decimal' : 'fraction'; document.getElementById('mode-text').innerText = displayMode.charAt(0).toUpperCase() + displayMode.slice(1); syncState(); refreshUI(); }
    function gcd(a, b) { return b ? gcd(b, a % b) : a; }
    
    function formatResult(val) {
        if (displayMode === 'decimal') return val.toFixed(4) + '"';
        const absVal = Math.abs(val), w = Math.floor(absVal), rem = absVal - w;
        let n, d;
        if (isSnapEnabled) { n = Math.round(rem * roundingDenominator); d = roundingDenominator; } else { n = Math.round(rem * 64); d = 64; }
        if (n === 0) return `${val < 0 ? '-' : ''}${w}"`;
        if (n === d) return `${val < 0 ? '-' : ''}${w + 1}"`;
        const c = gcd(n, d); return `${val < 0 ? '-' : ''}${w > 0 ? w + ' ' : ''}${n/c}/${d/c}"`;
    }
    
    function press(t, v) { if(t==='w'){ if(v==='.' && inputW.includes('.')) return; inputW = inputW === "0" && v !== '.' ? v.toString() : inputW + v; } else { inputN = inputN === "0" ? v.toString() : inputN + v; } updatePreview(); }
    function setDen(d) { inputD = d; updatePreview(); }
    function getCurrentIn() { return (parseFloat(inputW)||0) + ((parseInt(inputN)||0)/inputD); }
    
    function addToHistory(left, op, right, result) {
        const log = document.getElementById('history-log');
        const entry = document.createElement('div');
        entry.className = 'history-entry';
        entry.innerHTML = `<div class="history-text">${formatResult(left)} ${op} ${formatResult(right)} =</div><div class="history-result">${formatResult(result)}</div><button class="btn-recall" onclick="recallValue(${result})">‚Ü∫</button>`;
        log.prepend(entry);
    }

    function recallValue(val) { totalValue = val; isFirstEntry = false; updateDisplay(); }
    function handleOp(k) { 
        const c = getCurrentIn(); const oldTotal = totalValue;
        if(isFirstEntry){ totalValue = c; isFirstEntry = false; } 
        else { totalValue = ops[nextOp].fn(totalValue, c); addToHistory(oldTotal, ops[nextOp].sym, c, totalValue); } 
        nextOp = k; clearInput(); updateDisplay(); 
    }
    
    function finish() { 
        const c = getCurrentIn(); const oldTotal = totalValue;
        const result = !isFirstEntry ? ops[nextOp].fn(totalValue, c) : c;
        if (!isFirstEntry) addToHistory(oldTotal, ops[nextOp].sym, c, result);
        totalValue = result; isFirstEntry = true; updateDisplay(); clearInput(); nextOp = 'add'; 
    }

    function saveMeasurement() { const n = prompt("Part Name:"); if(n){ savedMeasurements.push({name:n, value:totalValue}); syncState(); updateSavedList(); } }
    function updateSavedList() { const b = document.getElementById('saved-list-body'); b.innerHTML = ''; savedMeasurements.forEach((m, i) => { b.innerHTML += `<tr><td>${m.name}</td><td class="highlight">${formatResult(m.value)}</td><td><button class="btn-del-save" onclick="deleteSave(${i})">X</button></td></tr>`; }); }
    function deleteSave(i) { savedMeasurements.splice(i, 1); syncState(); updateSavedList(); }
    function clearAllSaved() { if(confirm("Clear cut list?")){ savedMeasurements = []; syncState(); updateSavedList(); } }
    function updatePreview() { document.getElementById('preview').innerText = `${ops[nextOp].sym} ${formatResult(getCurrentIn())}`; }
    function updateDisplay() { document.getElementById('total').innerText = formatResult(totalValue); }
    function clearInput() { inputW = "0"; inputN = "0"; inputD = 1; updatePreview(); }
    function resetCalc() { totalValue = 0; isFirstEntry = true; document.getElementById('history-log').innerHTML = ''; clearInput(); updateDisplay(); }

    function toggleMirrorUI() { const m = document.getElementById('lay-mirror').checked; document.getElementById('mirror-input-container').style.display = m ? 'flex' : 'none'; document.getElementById('split-input-container').style.display = m ? 'none' : 'block'; calculateLayout(); syncState(); }
    function calculateLayout() {
        const L = parseFloat(document.getElementById('lay-length').value) || 0, n = parseInt(document.getElementById('lay-count').value) || 0, m = document.getElementById('lay-mirror').checked;
        let sOff = m ? parseFloat(document.getElementById('lay-offset-mirror').value)||0 : parseFloat(document.getElementById('lay-offset-start').value)||0;
        let eOff = m ? sOff : parseFloat(document.getElementById('lay-offset-end').value)||0;
        const b = document.getElementById('layout-table-body'); b.innerHTML = ''; if (L <= 0 || n <= 0) return;
        const use = L - sOff - eOff, gap = n > 1 ? use / (n - 1) : 0;
        for (let i = 0; i < n; i++) { b.innerHTML += `<tr><td>${i+1}</td><td class="highlight">${formatResult(sOff + (gap * i))}</td><td>${formatResult(gap)}</td></tr>`; }
        syncState();
    }

    function calculateBF() {
        const t = parseFloat(document.getElementById('bf-thick').value)||0, w = parseFloat(document.getElementById('bf-width').value)||0, l = parseFloat(document.getElementById('bf-length').value)||0, c = parseFloat(document.getElementById('bf-cost').value)||0, q = parseFloat(document.getElementById('bf-qty').value)||1;
        const currentBF = ((t * w * l) / 12) * q, currentCost = currentBF * c;
        document.getElementById('res-bf-val').innerText = currentBF.toFixed(2) + " BF";
        document.getElementById('res-bf-cost').innerText = "$" + currentCost.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        return { bf: currentBF, cost: currentCost };
    }
    function saveMaterial() { const name = prompt("Material Name:"); if(name) { const data = calculateBF(); savedMaterials.push({ name: name, bf: data.bf, cost: data.cost }); syncState(); updateMaterialList(); } }
    function updateMaterialList() {
        const body = document.getElementById('material-list-body'); body.innerHTML = '';
        let tBF = 0, tC = 0;
        savedMaterials.forEach((m, i) => { tBF += m.bf; tC += m.cost; body.innerHTML += `<tr><td>${m.name}</td><td>${m.bf.toFixed(2)}</td><td class="highlight">$${m.cost.toFixed(2)}</td><td><button class="btn-del-save" onclick="deleteMaterial(${i})">X</button></td></tr>`; });
        document.getElementById('grand-bf').innerText = tBF.toFixed(2) + " BF";
        document.getElementById('grand-cost').innerText = "$" + tC.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }
    function deleteMaterial(i) { savedMaterials.splice(i, 1); syncState(); updateMaterialList(); }
    function clearAllMaterials() { if(confirm("Clear?")){ savedMaterials = []; syncState(); updateMaterialList(); } }

    window.onload = loadProject;
</script>
</body>
</html>